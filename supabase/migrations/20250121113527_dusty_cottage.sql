-- Create wheat_predictions table
CREATE TABLE wheat_predictions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  date date NOT NULL,
  price decimal NOT NULL,
  is_forecast boolean DEFAULT false,
  confidence_lower decimal,
  confidence_upper decimal,
  created_at timestamptz DEFAULT now(),
  CONSTRAINT valid_confidence CHECK (
    (is_forecast = false AND confidence_lower IS NULL AND confidence_upper IS NULL) OR
    (is_forecast = true AND confidence_lower IS NOT NULL AND confidence_upper IS NOT NULL)
  ),
  UNIQUE(date)
);

-- Enable RLS
ALTER TABLE wheat_predictions ENABLE ROW LEVEL SECURITY;

-- Create policy for viewing predictions
CREATE POLICY "Wheat predictions are viewable by authenticated users"
  ON wheat_predictions FOR SELECT
  TO authenticated
  USING (true);

-- Create index for better query performance
CREATE INDEX idx_wheat_predictions_date ON wheat_predictions(date);

-- Insert the CSV data
INSERT INTO wheat_predictions (date, price, is_forecast, confidence_lower, confidence_upper) VALUES
('2024-12-21', 217.091231214814, false, NULL, NULL),
('2024-12-22', 219.245887821694, false, NULL, NULL),
('2024-12-23', 203.603821647852, false, NULL, NULL),
('2024-12-24', 219.614799874716, false, NULL, NULL),
('2024-12-25', 217.11847679434, false, NULL, NULL),
('2024-12-26', 215.971543864101, false, NULL, NULL),
('2024-12-27', 215.553482397296, false, NULL, NULL),
('2024-12-28', 206.84041707588, false, NULL, NULL),
('2024-12-29', 205.303477243499, false, NULL, NULL),
('2024-12-30', 216.567924289862, false, NULL, NULL),
('2024-12-31', 208.660925135923, false, NULL, NULL),
('2025-01-01', 214.603060025147, false, NULL, NULL),
('2025-01-02', 217.422111420707, false, NULL, NULL),
('2025-01-03', 214.24597778448, false, NULL, NULL),
('2025-01-04', 216.775207928834, false, NULL, NULL),
('2025-01-05', 204.077786623473, false, NULL, NULL),
('2025-01-06', 215.265423571627, false, NULL, NULL),
('2025-01-07', 211.234811507196, false, NULL, NULL),
('2025-01-08', 215.016650817027, false, NULL, NULL),
('2025-01-09', 214.321839318438, false, NULL, NULL),
('2025-01-10', 207.986574415212, false, NULL, NULL),
('2025-01-11', 219.401723100897, false, NULL, NULL),
('2025-01-12', 210.516737250519, false, NULL, NULL),
('2025-01-13', 218.227643727506, false, NULL, NULL),
('2025-01-14', 203.840217573878, false, NULL, NULL),
('2025-01-15', 218.180703216462, false, NULL, NULL),
('2025-01-16', 201.235217982634, false, NULL, NULL),
('2025-01-17', 205.901053761259, false, NULL, NULL),
('2025-01-18', 200.236571818567, false, NULL, NULL),
('2025-01-19', 204.9910957772, false, NULL, NULL),
('2025-01-20', 204.528659440448, false, NULL, NULL),
('2025-01-21', 205.14672774529, false, NULL, NULL),
('2025-01-22', 240.669590135011, true, 218.558786185055, 246.906291973476),
('2025-01-23', 235.472045454254, true, 215.733710170312, 246.399340062534),
('2025-01-24', 238.295421305738, true, 206.212229159704, 235.266309361685),
('2025-01-25', 221.98984739316, true, 208.923941306433, 239.000660251521),
('2025-01-26', 223.550145150465, true, 207.663527252632, 246.730538273888),
('2025-01-27', 222.855481072506, true, 212.809139334018, 249.341953345124),
('2025-01-28', 227.169095425334, true, 216.82681024488, 248.628990858382),
('2025-01-29', 232.675492784092, true, 217.010188253948, 235.540383026884),
('2025-01-30', 229.41140185628, true, 208.269477557552, 246.063576137845),
('2025-01-31', 243.945165334273, true, 208.937344046896, 240.263950363888),
('2025-02-01', 244.182737218257, true, 209.552190404476, 241.659997002208),
('2025-02-02', 231.943437577073, true, 210.523671575172, 246.847173664888),
('2025-02-03', 238.327657550935, true, 216.746746296307, 236.320478454624),
('2025-02-04', 244.247977051377, true, 205.696199340686, 249.296248222737),
('2025-02-05', 230.844238088218, true, 209.284934754089, 242.01671803082),
('2025-02-06', 225.569740191163, true, 207.691387185732, 240.881697821867),
('2025-02-07', 228.585079238164, true, 215.723586248226, 247.762199620575),
('2025-02-08', 244.298416198258, true, 213.587607168925, 246.828300214176),
('2025-02-09', 234.655518384056, true, 215.266874307905, 236.476727867027),
('2025-02-10', 241.714626540026, true, 216.542387282406, 248.102227945743),
('2025-02-11', 240.508999405562, true, 215.296339955342, 244.664841827847),
('2025-02-12', 235.81055556262, true, 217.102838061932, 242.83540886848),
('2025-02-13', 225.799089040231, true, 208.719209946942, 246.522384669265),
('2025-02-14', 227.178119060119, true, 218.855665898184, 243.670282769693),
('2025-02-15', 240.828580789271, true, 216.891923826615, 247.316625584987),
('2025-02-16', 223.646865846479, true, 209.129259852528, 236.308965864479),
('2025-02-17', 242.779018882363, true, 208.313126164721, 235.925858935614),
('2025-02-18', 225.656766074037, true, 214.535311656, 236.45861400737);